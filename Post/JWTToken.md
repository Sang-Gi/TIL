# Where to store JWT TOKEN

저번 Auctopus 프로젝트에서는 단순히 SNS 로그인 서비스로만 유저 관리를 했고, 유저의 개인정보와 토큰을 localStorage에 담아서 보관했다. 단순히 JWT의 access token을 보관하고 API요청시 헤더에 담아주는 방법을 사용했다.

# 로그인 프로세스

> 크게 **서버 기반 인증 시스템**과 **토큰 기반 인증 시스템**으로 나뉜다.

## 1. 세션 id를 사용하는 방식

> 서버는 특정 유저의 정보를 담은 세션을 생성한다.

![SessionId](./assets/SessionId.png)

1. 클라이언트가 로그인 요청
2. 서버는 `session`을 생성
3. 그 세션의 `id` 를 클라이언트에 전달
4. 클라이언트는 `session id` 를 보관
5. 인증이 필요한 데이터를 요청할 때, `session id` 를 서버에 전달
6. 서버는 `session id` 를 통해 유효성 검사

## 2. JWT를 이용하는 방식

> JSON Web Token의 약자로 모바일이나 웹의 사용자 인증을 `refreshToken` 과 `accessToken` 같은 암호화된 토큰을 의미한다.
> `accessToken` 을 `request` 에 담아 유효성 검사를 한다.

![JWT](./assets/JWT.png)

1. 클라이언트가 로그인 요청
2. 서버에서 JWT 암호화 후 `refreshToken` 과 `accessToken` 을 클라이언트에 전달
3. 클라이언트는 토큰을 보관
4. 인증, 인가가 필요한 요청을 보낼시에, `accessToken` 을 담아서 같이 전송
5. 서버에서는 토큰을 활용해 유효성 검사

### 토큰 추가 설명

실질적인 인증 정보는 `accessToken` 을 통해 이루어진다. 하지만 일정 시간이 지나면 만료하는 토큰이다. 만료가 된 `accessToken` 은 `refreshToken` 을 통해 갱신할 수 있다.

클라이언트가 `accessToken` 을 통해 요청을 보냈을 때, 토큰이 만료되었다면 `refreshToken` 을 보내 새로운 `accessToken` 을 받아와 재요청을 하면된다. `refreshToken` 은 옵션이기 때문에 필요에 따라 사용하자!

# 우린 왜 JWT인증 방식을 택했는가?

### 세션 인증

- **세션**은 메모리 또는 DB에 저장하는데, 로그인 요청이 많아질 경우 부하가 걸린다.
- 사용자가 늘어나면 서버를 확장해야 하는데, 세션을 분산시키는 시스템 설계가 어려워 **확장성이 낮다.**

### 토큰 인증

- 토큰은 클라이언트측에서 보관하기 때문에, **서버는 완전히 stateless하며, 확장성이 높다.**
- 토큰에 **선택적인 권한만 부여**하여 발급이 가능하다.
- OAuth의 경우 소셜 계정을 이용해 다른 웹서비스에서도 로그인을 할 수 있다.
